## 路径规划应用 pgRouting 实践与开放地图导入 - Openstreetmap PBF  
                                       
### 作者                      
digoal                      
                      
### 日期                       
2015-08-13                    
                        
### 标签                      
PostgreSQL , PostGIS , pgrouting , 路径规划 , osm , openstreetmap    
                                  
----                                  
                                   
## 背景                       
  
## pgRouting Project  
  
pgRouting extends the PostGIS / PostgreSQL geospatial database to provide geospatial routing functionality.  
  
Advantages of the database routing approach are:  
  
Data and attributes can be modified by many clients, like QGIS and uDig through JDBC, ODBC, or directly using Pl/pgSQL. The clients can either be PCs or mobile devices.  
  
Data changes can be reflected instantaneously through the routing engine. There is no need for precalculation.  
  
The “cost” parameter can be dynamically calculated through SQL and its value can come from multiple fields or tables.  
  
### Core Features  
pgRouting provides functions for:  
  
All Pairs Shortest Path, Johnson’s Algorithm [1]  
  
All Pairs Shortest Path, Floyd-Warshall Algorithm [1]  
  
Shortest Path A*  
  
Bi-directional Dijkstra Shortest Path [1]  
  
Bi-directional A* Shortest Path [1]  
  
Shortest Path Dijkstra  
  
Driving Distance  
  
K-Shortest Path, Multiple Alternative Paths [1]  
  
K-Dijkstra, One to Many Shortest Path [1]  
  
Traveling Sales Person  
  
Turn Restriction Shortest Path (TRSP) [1]  
  
Shortest Path Shooting Star [2]  
  
Learn more about using pgRouting in your application by reading the documentation.  
  
### pgRouting is Open Source  
pgRouting is available under the GPLv2 license and is supported by a growing community of individuals, businesses and organizations.  
  
PostgreSQL还有一个FDW插件osm_fdw，可以在数据库读取PBF文件的内容当成表来使用。  
  
```  
How to use  
  
Create extension at first:  
  
CREATE EXTENSION osm_fdw;  
  
To access foreign data, you need to create a foreign server object:  
  
CREATE SERVER osm_fdw_server FOREIGN DATA WRAPPER osm_fdw;  
  
Next you should create foreign table. There are two ways: CREATE FOREIGN TABLE query and create_osm_table function. I strongly recommend to use second method. The function create_osm_table(text, text, text) is provided together with the extension. It requires 3 parameters: a name of the table, a name of the foreign server object and a path to *.osm.pbf file.  
  
SELECT create_osm_table('table_name', 'osm_fdw_server', '/path_to_file/file.osm.pbf');  
  
FDW start to read the file with every query. I would recommend to create materialized view to fast data access.  
  
CREATE MATERIALIZED VIEW osm_data AS SELECT * FROM osm_foreign_table WITH DATA;  
  
Table structure  
  
Table should have this structure:  
  
CREATE FOREIGN TABLE table_name (  
    id bigint,  
    type text,  
    lat double precision,  
    lon double precision,  
    tags jsonb,  
    refs bigint[],  
    members jsonb,  
  
    version int,  
    modified timestamp,  
    changeset bigint,  
    user_id int,  
    username text,  
    visible boolean  
)  
SERVER osm_fdw_server  
OPTIONS (  
    filename '/path_to_file/file.osm.pbf'  
);  
Fields can have other names, but position and types must be as in this example.  
  
Column types  
  
The FDW can read 3 openstreetmap types: (NODE), (WAY) and (RELATION).  
  
* `id` - OSM object id  
* `type` - type of the object (Values: NODE, WAY, RELATION)  
* `lat` - latitude (not empty only for NODE)  
* `lon` - longitude (not empty only for NODE type)  
* `tags` - json object with OSM tags (json for postgres 9.3 and jsonb for 9.4)  
* `refs` - array on node ids (not empty only for WAY)  
* `members` - array of objects with relation members (not empty only for RELATION; json for postgres 9.3 and jsonb for 9.4)  
* `version` - OSM version  
* `modified` - OSM last change date  
* `changeset` - OSM changeset  
* `user_id` - id of the OSM user  
* `username` - name of the OSM user  
* `visible` - shows if object is visible  
```  
  
## 参考  
https://github.com/vpikulik/postgres_osm_pbf_fdw/blob/master/doc/osm_fdw.md  
  
https://github.com/pgRouting  
  
https://www.opentreemap.org/  
  
http://pgrouting.org/  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [免费领取阿里云RDS PostgreSQL实例、ECS虚拟机](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [大量阿里云PG解决方案: 任意维度实时圈人; 时序数据实时处理; 时间、空间、业务 多维数据实时透视; 独立事件相关性分析; 海量关系实时图式搜索; 社交业务案例; 流式数据实时处理案例; 物联网; 全文检索; 模糊、正则查询案例; 图像识别; 向量相似检索; 数据清洗、采样、脱敏、批处理、合并; GIS 地理信息空间数据应用; 金融业务; 异步消息应用案例; 海量数据 冷热分离; 倒排索引案例; 海量数据OLAP处理应用;](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥的 / digoal's PostgreSQL文章入口 - 努力做成PG资源最丰富的个人blog](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![德哥的微信 / digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
