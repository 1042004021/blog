## PostgreSQL monitor - customize nagios script  
                 
### 作者                 
digoal                  
                    
### 日期                  
2013-06-05                                            
                  
### 标签                                                                                                                                  
PostgreSQL , 监控 , nagios , check_postgres , customize nagios script               
                
----                  
                
## 背景            
前一个章节介绍了使用bucardo提供的check_postgres脚本和nagios来监控数据库.   
  
本文主要介绍如何编写自定义监控脚本.  
  
在编写自定义脚本前首先要搞清楚nagios的判断标准.  
  
1\. 脚本的返回值  
  
nagios根据脚本返回值来输出该监控服务的状态. 返回值和状态对应关系如下.  
  
```  
0 : (OK)  
1 : (WARNING)  
2 : (CRITICAL)  
other : (UNKNOWN)  
```  
  
2\. 脚本的标准输出  
  
```  
pg92@db-172-16-3-39-> /opt/check_postgres-2.20.0/check_postgres.pl --PGBINDIR=/opt/pgsql92/bin --output=nagios --datadir=/pgdata1919 --action=checkpoint -w 300s -c 600s  
POSTGRES_CHECKPOINT CRITICAL:  Last checkpoint was 11418 seconds ago | age=11418;300;600   
```  
  
以上监控命令的标准输出为  
  
```  
POSTGRES_CHECKPOINT CRITICAL:  Last checkpoint was 11418 seconds ago | age=11418;300;600  
```  
  
注意|这个字符, 这个字符分隔了两部分信息 :  
  
```  
Status Information  
Performance Data  
```  
  
如图 :   
  
![pic](20130605_03_pic_001.png)  
   
3\. 被监控机上的脚本是在nagios服务端通过check_nrpe远程调用的方式执行的.  
  
被监控端的nrpe程序以什么用户组执行在如下配置中 :   
  
```  
[root@db-172-16-3-39 check_postgres-2.20.0]# cat /etc/xinetd.d/nrpe |grep -E "group|user"  
        user            = pg92  
        group           = pg92  
```  
  
因此监控脚本需要有以上用户组的可执行权限.  
  
编写自定义脚本时需要遵循前面提到的3点.  
  
使用nagios监控常用PostgreSQL监控项举例 :   
  
http://blog.163.com/digoal@126/blog/static/163877040201412763135184/  
  
## 参考  
1\. http://blog.163.com/digoal@126/blog/static/1638770402013121102459107/  
  
2\. http://blog.163.com/digoal@126/blog/static/163877040201312241028667/  
  
3\. http://blog.163.com/digoal@126/blog/static/163877040201302714527/  
  
4\. http://blog.163.com/digoal@126/blog/static/16387704020130433036377/  
  
5\. http://blog.163.com/digoal@126/blog/static/163877040201292245228613/  
  
6\. http://blog.163.com/digoal@126/blog/static/163877040201141134748660/  
  
7\. http://blog.163.com/digoal@126/blog/static/16387704020116111445381/  
  
8\. http://blog.163.com/digoal@126/blog/static/16387704020130525628988/  
                                                                      
                                                                              
                                    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [免费领取阿里云RDS PostgreSQL实例、ECS虚拟机](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [大量阿里云PG解决方案: 任意维度实时圈人; 时序数据实时处理; 时间、空间、业务 多维数据实时透视; 独立事件相关性分析; 海量关系实时图式搜索; 社交业务案例; 流式数据实时处理案例; 物联网; 全文检索; 模糊、正则查询案例; 图像识别; 向量相似检索; 数据清洗、采样、脱敏、批处理、合并; GIS 地理信息空间数据应用; 金融业务; 异步消息应用案例; 海量数据 冷热分离; 倒排索引案例; 海量数据OLAP处理应用;](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥的 / digoal's PostgreSQL文章入口 - 努力做成PG资源最丰富的个人blog](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![德哥的微信 / digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
