## PostgreSQL 12 preview - 支持replica slot复制(copy slot)  
                                                                                                                        
### 作者                                                                                                                        
digoal                                                                                                                        
                                                                                                                        
### 日期                                                                                                                        
2019-04-09                                                                                                                        
                                                                                                                        
### 标签                                                                                                                        
PostgreSQL , replica slot , copy slot , 并行复制 , pg_copy_physical_replication_slot , pg_copy_logical_replication_slot     
                                       
----                                                                                                                  
                                                                                                                    
## 背景     
允许copy一个已有的slot，COPY后的slot可以和原来的SLOT完全一样，也可以只是修改一下logical decode。  
  
应用场景：  
  
例如一个basebackup，可以开启多个并行备份任务。  
  
```  
Add facility to copy replication slots  
author	Alvaro Herrera <alvherre@alvh.no-ip.org>	  
Sat, 6 Apr 2019 01:52:45 +0800 (14:52 -0300)  
committer	Alvaro Herrera <alvherre@alvh.no-ip.org>	  
Sat, 6 Apr 2019 05:05:18 +0800 (18:05 -0300)  
commit	9f06d79ef831ffa333f908f6d3debdb654292414  
tree	ce7f58c5a4ed40c143244ec271134b8a343c8f69	tree | snapshot  
parent	de2b38419c4018fc8c2c917cc2cc752063096cfb	commit | diff  
Add facility to copy replication slots  
  
This allows the user to create duplicates of existing replication slots,  
either logical or physical, and even changing properties such as whether  
they are temporary or the output plugin used.  
  
There are multiple uses for this, such as initializing multiple replicas  
using the slot for one base backup; when doing investigation of logical  
replication issues; and to select a different output plugins.  
  
Author: Masahiko Sawada  
Reviewed-by: Michael Paquier, Andres Freund, Petr Jelinek  
Discussion: https://postgr.es/m/CAD21AoAm7XX8y_tOPP6j4Nzzch12FvA1wPqiO690RCk+uYVstg@mail.gmail.com  
```  
  
接口：  
  
```  
pg_copy_physical_replication_slot(src_slot_name name, dst_slot_name name [, temporary boolean])  
  
Copies an existing physical replication slot name src_slot_name to a physical replication slot named dst_slot_name.   
The copied physical slot starts to reserve WAL from the same LSN as the source slot.   
temporary is optional. If temporary is omitted, the same value as the source slot is used.  
  
pg_copy_logical_replication_slot(src_slot_name name, dst_slot_name name [, temporary boolean [, plugin name]])  
  
Copies an existing logical replication slot name src_slot_name to a logical replication slot named dst_slot_name   
while changing the output plugin and persistence. The copied logical slot starts from the same LSN as   
the source logical slot. Both temporary and plugin are optional.   
If temporary or plugin are omitted, the same values as the source logical slot are used.  
```  
  
## 参考  
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=9f06d79ef831ffa333f908f6d3debdb654292414  
  
https://www.postgresql.org/docs/devel/functions-admin.html#FUNCTIONS-REPLICATION    
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [免费领取阿里云RDS PostgreSQL实例、ECS虚拟机](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [大量阿里云PG解决方案: 任意维度实时圈人; 时序数据实时处理; 时间、空间、业务 多维数据实时透视; 独立事件相关性分析; 海量关系实时图式搜索; 社交业务案例; 流式数据实时处理案例; 物联网; 全文检索; 模糊、正则查询案例; 图像识别; 向量相似检索; 数据清洗、采样、脱敏、批处理、合并; GIS 地理信息空间数据应用; 金融业务; 异步消息应用案例; 海量数据 冷热分离; 倒排索引案例; 海量数据OLAP处理应用;](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥的 / digoal's PostgreSQL文章入口 - 努力做成PG资源最丰富的个人blog](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![德哥的微信 / digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
