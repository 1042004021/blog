## PostgreSQL standard_conforming_strings and escape_string_warning  
                               
### 作者              
digoal              
              
### 日期               
2013-05-21              
                
### 标签              
PostgreSQL , escape , 逃逸字符    
                          
----                          
                           
## 背景      
```  
escape_string_warning (boolean)  
  
When on, a warning is issued if a backslash (\) appears in an   
ordinary string literal ('...' syntax) and standard_conforming_strings is off.   
The default is on.  
  
Applications that wish to use backslash as escape should be modified   
to use escape string syntax (E'...'), because the default behavior of   
ordinary strings is now to treat backslash as an ordinary character,   
per SQL standard.   
This variable can be enabled to help locate code that needs to be changed.  
  
standard_conforming_strings (boolean)  
  
This controls whether ordinary string literals ('...') treat backslashes literally,   
as specified in the SQL standard. Beginning in PostgreSQL 9.1, the default is on   
(prior releases defaulted to off). Applications can check this parameter to   
determine how string literals will be processed. The presence of this parameter   
can also be taken as an indication that the escape string syntax (E'...') is supported.   
Escape string syntax (Section 4.1.2.2) should be used if an application desires   
backslashes to be treated as escape characters.  
```  
  
注意这句话. 在SQL标准中, \作为普通字符使用.   
  
```  
the default behavior of ordinary strings is now to treat backslash as an ordinary character, per SQL standard.  
```  
  
```  
所以standard_conforming_strings=on时,  \作为普通字符.   
  
standard_conforming_strings=off时,  \作为逃逸字符使用. 但是建议使用E''格式, escape_string_warning 就是用来检测格式的配置.  
```  
  
## 例子  
1\. standard_conforming_strings=on时,  ```\```作为普通字符.  
    如果要将```\```作为逃逸字符, 必须使用E''格式.  
  
```  
digoal=# \set VERBOSITY verbose  
digoal=# set standard_conforming_strings=on;  
SET  
digoal=# set escape_string_warning=on;  
SET  
digoal=# select '\nabc';  
 ?column?   
----------  
 \nabc  
(1 row)  
digoal=# select E'\nabc';  
 ?column?   
----------  
         +  
 abc  
(1 row)  
digoal=# set standard_conforming_strings=on;  
SET  
digoal=# set escape_string_warning=off;  
SET  
digoal=# select '\nabc';  
 ?column?   
----------  
 \nabc  
(1 row)  
digoal=# select E'\nabc';  
 ?column?   
----------  
         +  
 abc  
(1 row)  
```  
  
2\. standard_conforming_strings=off时,  ```\```作为逃逸字符. 但是这么使用, escape_string_warning=on时会提示警告.  
    使用E''格式这不会告警.  
  
```  
digoal=# set standard_conforming_strings=off;  
SET  
digoal=# set escape_string_warning=off;  
SET  
digoal=# select '\nabc';  
 ?column?   
----------  
         +  
 abc  
(1 row)  
digoal=# select E'\nabc';  
 ?column?   
----------  
         +  
 abc  
(1 row)  
digoal=# set standard_conforming_strings=off;  
SET  
digoal=# set escape_string_warning=on;  
SET  
digoal=# select '\nabc';  
WARNING:  22P06: nonstandard use of escape in a string literal  
LINE 1: select '\nabc';  
               ^  
HINT:  Use the escape string syntax for escapes, e.g., E'\r\n'.  
LOCATION:  check_escape_warning, scan.l:1458  
 ?column?   
----------  
         +  
 abc  
(1 row)  
  
digoal=# select E'\nabc';  
 ?column?   
----------  
         +  
 abc  
(1 row)  
```  
  
## 参考  
1\. http://www.postgresql.org/docs/9.3/static/runtime-config-compatible.html  
  
2\. http://www.postgresql.org/docs/9.3/static/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [9.9元购买3个月阿里云RDS PostgreSQL实例](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PostgreSQL 解决方案集合](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [1 任意维度实时圈人](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [2 时序数据实时处理](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [3 时间、空间、业务 多维数据实时透视](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [4 独立事件相关性分析](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [5 海量关系实时图式搜索](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [6 社交业务案例](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [7 流式数据实时处理案例](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [8 IoT 物联网, 时序](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [9 全文检索](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [10 模糊、正则 查询案例](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [11 图像识别](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [12 向量相似检索](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [13 数据清洗、采样、脱敏、批处理、合并](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [14 GIS 地理信息空间数据应用](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [15 金融业务](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [16 异步消息应用案例](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [17 海量数据 冷热分离](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [18 倒排索引案例](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
- [19 海量数据OLAP处理应用](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's 趣味入口 - 努力成为灯塔, 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![德哥的微信 / digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
